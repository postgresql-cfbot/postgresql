/* System periods are not implemented */
create table pt (id integer, ds date, de date, period for system_time (ds, de));
ERROR:  PERIOD FOR SYSTEM_TIME is not supported
LINE 2: create table pt (id integer, ds date, de date, period for sy...
                                                       ^
/* Periods must specify actual columns */
create table pt (id integer, ds date, de date, period for p (bogus, de));
ERROR:  column "bogus" of relation "pt" does not exist
create table pt (id integer, ds date, de date, period for p (ds, bogus));
ERROR:  column "bogus" of relation "pt" does not exist
/* Data types must match exactly */
create table pt (id integer, ds date, de timestamp, period for p (ds, de));
ERROR:  start and end columns of period must be of same type
create table pt (id integer, ds text collate "C", de text collate "POSIX", period for p (ds, de));
ERROR:  start and end columns of period must have same collation
/* Periods must have a default BTree operator class */
create table pt (id integer, ds xml, de xml, period for p (ds, de));
ERROR:  no range type for xml found for period p
HINT:  You can define a custom range type with CREATE TYPE
/* Period and column names are in the same namespace */
create table pt (id integer, ds date, de date, period for ctid (ds, de));
ERROR:  period name "ctid" conflicts with a system column name
create table pt (id integer, ds date, de date, period for id (ds, de));
ERROR:  period name "id" conflicts with a column name
/* Now make one that works */
create table pt (id integer, ds date, de date, period for p (ds, de));
/*
 * CREATE TABLE currently adds an ALTER TABLE to add the periods, but let's do
 * some explicit testing anyway
 */
alter table pt drop period for p;
alter table pt add period for system_time (ds, de);
ERROR:  PERIOD FOR SYSTEM_TIME is not supported
alter table pt add period for p (ds, de);
/* Can't drop its columns */
alter table pt drop column ds;
ERROR:  cannot drop column ds of table pt because other objects depend on it
DETAIL:  period p on table pt depends on column ds of table pt
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
alter table pt drop column de;
ERROR:  cannot drop column de of table pt because other objects depend on it
DETAIL:  period p on table pt depends on column de of table pt
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
/* Can't change the data types */
alter table pt alter column ds type timestamp;
ERROR:  cannot alter type of a column used by a period
DETAIL:  period p on table pt depends on column "ds"
alter table pt alter column ds type timestamp;
ERROR:  cannot alter type of a column used by a period
DETAIL:  period p on table pt depends on column "ds"
/* column/period namespace conflicts */
alter table pt add column p integer;
ERROR:  column name "p" conflicts with a period name
alter table pt rename column id to p;
ERROR:  column name "p" conflicts with a period name
/* adding columns and the period at the same time */
create table pt2 (id integer);
alter table pt2 add column ds date, add column de date, add period for p (ds, de);
drop table pt2;
/* Ambiguous range types raise an error */
create type mydaterange as range(subtype=date);
create table pt2 (id int, ds date, de date, period for p (ds, de));
ERROR:  ambiguous range for type date
/* You can give an explicit range type */
create table pt2 (id int, ds date, de date, period for p (ds, de) with (rangetype = 'mydaterange'));
drop type mydaterange;
ERROR:  cannot drop type mydaterange because other objects depend on it
DETAIL:  period p on table pt2 depends on type mydaterange
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
drop type mydaterange cascade;
NOTICE:  drop cascades to period p on table pt2
drop table pt2;
create table pt2 (id int, ds date, de date, period for p (ds, de) with (rangetype = 'daterange'));
/* Range type is not found */
create table pt3 (id int, ds date, de date, period for p (ds, de) with (rangetype = 'notarange'));
ERROR:  Range type notarange not found
/* Range type is the wrong type */
create table pt3 (id int, ds date, de date, period for p (ds, de) with (rangetype = 'tstzrange'));
ERROR:  Range type tstzrange does not match column type date
