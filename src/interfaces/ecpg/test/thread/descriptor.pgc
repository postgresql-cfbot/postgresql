#include "port/pg_threads.h"

#define THREADS		16
#define REPEATS		50000

EXEC SQL include sqlca;
EXEC SQL whenever sqlerror sqlprint;
EXEC SQL whenever not found sqlprint;

static int fn(void* arg)
{
	int i;

	for (i = 1; i <= REPEATS; ++i)
	{
		EXEC SQL ALLOCATE DESCRIPTOR mydesc;
		EXEC SQL DEALLOCATE DESCRIPTOR mydesc;
	}

	return 0;
}

int main ()
{
	int i;
	pg_thrd_t threads[THREADS];

	for (i = 0; i < THREADS; ++i)
		pg_thrd_create(&threads[i], fn, NULL);
	for (i = 0; i < THREADS; ++i)
		pg_thrd_join(threads[i], NULL);

	return 0;
}
