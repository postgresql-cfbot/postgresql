CREATE SCHEMA create_property_graph_tests;
GRANT USAGE ON SCHEMA create_property_graph_tests TO PUBLIC;
SET search_path = create_property_graph_tests;
CREATE ROLE regress_graph_user1;
CREATE ROLE regress_graph_user2;
CREATE PROPERTY GRAPH g1;
COMMENT ON PROPERTY GRAPH g1 IS 'a graph';
CREATE PROPERTY GRAPH g1;  -- error: duplicate
ERROR:  relation "g1" already exists
CREATE TABLE t1 (a int, b text);
CREATE TABLE t2 (i int PRIMARY KEY, j int, k int);
CREATE TABLE t3 (x int, y text, z text);
CREATE TABLE e1 (a int, i int, t text, PRIMARY KEY (a, i));
CREATE TABLE e2 (a int, x int, t text);
CREATE PROPERTY GRAPH g2
    VERTEX TABLES (t1 KEY (a), t2 DEFAULT LABEL, t3 KEY (x) LABEL t3l1 LABEL t3l2)
    EDGE TABLES (
        e1
            SOURCE KEY (a) REFERENCES t1 (a)
            DESTINATION KEY (i) REFERENCES t2 (i),
        e2 KEY (a, x)
            SOURCE KEY (a) REFERENCES t1 (a)
            DESTINATION KEY (x, t) REFERENCES t3 (x, y)
    );
-- test dependencies/object descriptions
DROP TABLE t1;  -- fail
ERROR:  cannot drop table t1 because other objects depend on it
DETAIL:  vertex t1 of property graph g2 depends on table t1
edge e1 of property graph g2 depends on table t1
edge e2 of property graph g2 depends on table t1
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
ALTER TABLE t1 DROP COLUMN b;  -- non-key column; fail
ERROR:  cannot drop column b of table t1 because other objects depend on it
DETAIL:  property b of label t1 of vertex t1 of property graph g2 depends on column b of table t1
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
ALTER TABLE t1 DROP COLUMN a;  -- key column; fail
ERROR:  cannot drop column a of table t1 because other objects depend on it
DETAIL:  vertex t1 of property graph g2 depends on column a of table t1
edge e1 of property graph g2 depends on column a of table t1
edge e2 of property graph g2 depends on column a of table t1
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
-- like g2 but assembled with ALTER
CREATE PROPERTY GRAPH g3;
ALTER PROPERTY GRAPH g3 ADD VERTEX TABLES (t1 KEY (a), t2 DEFAULT LABEL);
ALTER PROPERTY GRAPH g3
    ADD VERTEX TABLES (t3 KEY (x) LABEL t3l1)
    ADD EDGE TABLES (
        e1 SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (i) REFERENCES t2 (i),
        e2 KEY (a, x) SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (x, t) REFERENCES t3 (x, y)
    );
ALTER PROPERTY GRAPH g3 ALTER VERTEX TABLE t3 ADD LABEL t3l2 PROPERTIES ALL COLUMNS ADD LABEL t3l3 PROPERTIES ALL COLUMNS;
ALTER PROPERTY GRAPH g3 ALTER VERTEX TABLE t3 DROP LABEL t3l3x;  -- error
ERROR:  property graph "g3" element "t3" has no label "t3l3x"
ALTER PROPERTY GRAPH g3 ALTER VERTEX TABLE t3 DROP LABEL t3l3;
ALTER PROPERTY GRAPH g3 DROP VERTEX TABLES (t2);  -- fail (TODO: dubious error message)
ERROR:  cannot drop vertex t2 of property graph g3 because other objects depend on it
DETAIL:  edge e1 of property graph g3 depends on vertex t2 of property graph g3
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
ALTER PROPERTY GRAPH g3 DROP VERTEX TABLES (t2) CASCADE;
NOTICE:  drop cascades to edge e1 of property graph g3
ALTER PROPERTY GRAPH g3 DROP EDGE TABLES (e2);
CREATE PROPERTY GRAPH g4
    VERTEX TABLES (
        t1 KEY (a) NO PROPERTIES,
        t2 DEFAULT LABEL PROPERTIES (i + j AS i_j, k),
        t3 KEY (x) LABEL t3l1 PROPERTIES (x, y AS yy) LABEL t3l2 PROPERTIES (x, z AS zz)
    )
    EDGE TABLES (
        e1
            SOURCE KEY (a) REFERENCES t1 (a)
            DESTINATION KEY (i) REFERENCES t2 (i)
            PROPERTIES ALL COLUMNS,
        e2 KEY (a, x)
            SOURCE KEY (a) REFERENCES t1 (a)
            DESTINATION KEY (x, t) REFERENCES t3 (x, y)
            PROPERTIES ALL COLUMNS
    );
ALTER PROPERTY GRAPH g4 ALTER VERTEX TABLE t2 ALTER LABEL t2 ADD PROPERTIES (k * 2 AS kk);
ALTER PROPERTY GRAPH g4 ALTER VERTEX TABLE t2 ALTER LABEL t2 DROP PROPERTIES (k);
CREATE TABLE t11 (a int PRIMARY KEY);
CREATE TABLE t12 (b int PRIMARY KEY);
CREATE TABLE t13 (
    c int PRIMARY KEY,
    d int REFERENCES t11,
    e int REFERENCES t12
);
CREATE PROPERTY GRAPH g5
    VERTEX TABLES (t11, t12)
    EDGE TABLES (t13 SOURCE t11 DESTINATION t12);
SELECT pg_get_propgraphdef('g5'::regclass);
                                                pg_get_propgraphdef                                                
-------------------------------------------------------------------------------------------------------------------
 CREATE PROPERTY GRAPH create_property_graph_tests.g5                                                             +
     VERTEX TABLES (                                                                                              +
         t11 KEY (a) PROPERTIES (a),                                                                              +
         t12 KEY (b) PROPERTIES (b)                                                                               +
     )                                                                                                            +
     EDGE TABLES (                                                                                                +
         t13 KEY (c) SOURCE KEY (e) REFERENCES t11 (a) DESTINATION KEY (e) REFERENCES t12 (b) PROPERTIES (c, d, e)+
     )
(1 row)

-- error cases
CREATE PROPERTY GRAPH gx VERTEX TABLES (xx, yy);
ERROR:  relation "xx" does not exist
CREATE PROPERTY GRAPH gx VERTEX TABLES (t1 KEY (a), t2 KEY (i), t1 KEY (a));
ERROR:  alias "t1" used more than once as element table
LINE 1: ...Y GRAPH gx VERTEX TABLES (t1 KEY (a), t2 KEY (i), t1 KEY (a)...
                                                             ^
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (t1 AS tt KEY (a), t2 KEY (i))
    EDGE TABLES (
        e1 SOURCE t1 DESTINATION t2
    );
ERROR:  source vertex "t1" of edge "e1" does not exist
LINE 4:         e1 SOURCE t1 DESTINATION t2
                ^
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (t1 KEY (a), t2 KEY (i))
    EDGE TABLES (
        e1 SOURCE t1 DESTINATION tx
    );
ERROR:  destination vertex "tx" of edge "e1" does not exist
LINE 4:         e1 SOURCE t1 DESTINATION tx
                ^
COMMENT ON PROPERTY GRAPH gx IS 'not a graph';
ERROR:  relation "gx" does not exist
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (t1 KEY (a), t2)
    EDGE TABLES (
        e1 SOURCE t1 DESTINATION t2  -- no foreign keys
    );
ERROR:  no SOURCE key specified and no suitable foreign key exists for definition of edge "e1"
LINE 4:         e1 SOURCE t1 DESTINATION t2  -- no foreign keys
                ^
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (
        t1 KEY (a) LABEL foo PROPERTIES (a + 1 AS aa)
                   LABEL bar PROPERTIES (1 + a AS aa)  -- expression mismatch
    );
ERROR:  element "t1" property "aa" expression mismatch: (1 + a) vs. (a + 1)
DETAIL:  In a property graph element, a property of the same name has to have the same expression in each label.
ALTER PROPERTY GRAPH g2
    ADD VERTEX TABLES (
        t1 AS t1x KEY (a) LABEL foo PROPERTIES (a + 1 AS aa)
                          LABEL bar PROPERTIES (1 + a AS aa)  -- expression mismatch
    );
ERROR:  element "t1x" property "aa" expression mismatch: (1 + a) vs. (a + 1)
DETAIL:  In a property graph element, a property of the same name has to have the same expression in each label.
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (
        t1 KEY (a) PROPERTIES (b AS p1),
        t2 PROPERTIES (k AS p1)  -- type mismatch
    );
ERROR:  property "p1" data type mismatch: text vs. integer
DETAIL:  In a property graph, a property of the same name has to have the same data type in each label.
ALTER PROPERTY GRAPH g2 ALTER VERTEX TABLE t1 ADD LABEL foo PROPERTIES (b AS k);  -- type mismatch
ERROR:  property "k" data type mismatch: integer vs. text
DETAIL:  In a property graph, a property of the same name has to have the same data type in each label.
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (
        t1 KEY (a) LABEL l1 PROPERTIES (a, a AS aa),
        t2 KEY (i) LABEL l1 PROPERTIES (i AS a, j AS b, k)  -- mismatching number of properties on label
    );
ERROR:  mismatching number of properties in definition of label "l1"
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (
        t1 KEY (a) LABEL l1 PROPERTIES (a, b),
        t2 KEY (i) LABEL l1 PROPERTIES (i AS a)  -- mismatching number of properties on label
    );
ERROR:  mismatching number of properties in definition of label "l1"
CREATE PROPERTY GRAPH gx
    VERTEX TABLES (
        t1 KEY (a) LABEL l1 PROPERTIES (a, b),
        t2 KEY (i) LABEL l1 PROPERTIES (i AS a, j AS j)  -- mismatching property names on label
    );
ERROR:  mismatching properties names in definition of label "l1"
ALTER PROPERTY GRAPH g4 ALTER VERTEX TABLE t1 ADD LABEL t3l1 PROPERTIES (a AS x, b AS yy, b AS zz);  -- mismatching number of properties on label
ERROR:  mismatching number of properties in definition of label "t3l1"
ALTER PROPERTY GRAPH g4 ALTER VERTEX TABLE t1 ADD LABEL t3l1 PROPERTIES (a AS x, b AS zz);  -- mismatching property names on label
ERROR:  mismatching properties names in definition of label "t3l1"
ALTER PROPERTY GRAPH g4 ALTER VERTEX TABLE t1 ADD LABEL t3l1 PROPERTIES (a AS x);  -- mismatching number of properties on label
ERROR:  mismatching number of properties in definition of label "t3l1"
ALTER PROPERTY GRAPH g1 OWNER TO regress_graph_user1;
SET ROLE regress_graph_user1;
GRANT SELECT ON PROPERTY GRAPH g1 TO regress_graph_user2;
GRANT UPDATE ON PROPERTY GRAPH g1 TO regress_graph_user2;  -- fail
ERROR:  invalid privilege type UPDATE for property graph
RESET ROLE;
-- information schema
SELECT * FROM information_schema.property_graphs ORDER BY property_graph_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name 
------------------------+-----------------------------+---------------------
 regression             | create_property_graph_tests | g1
 regression             | create_property_graph_tests | g2
 regression             | create_property_graph_tests | g3
 regression             | create_property_graph_tests | g4
 regression             | create_property_graph_tests | g5
(5 rows)

SELECT * FROM information_schema.pg_element_tables ORDER BY property_graph_name, element_table_alias;
 property_graph_catalog |    property_graph_schema    | property_graph_name | element_table_alias | element_table_kind | table_catalog |        table_schema         | table_name | element_table_definition 
------------------------+-----------------------------+---------------------+---------------------+--------------------+---------------+-----------------------------+------------+--------------------------
 regression             | create_property_graph_tests | g2                  | e1                  | EDGE               | regression    | create_property_graph_tests | e1         | 
 regression             | create_property_graph_tests | g2                  | e2                  | EDGE               | regression    | create_property_graph_tests | e2         | 
 regression             | create_property_graph_tests | g2                  | t1                  | VERTEX             | regression    | create_property_graph_tests | t1         | 
 regression             | create_property_graph_tests | g2                  | t2                  | VERTEX             | regression    | create_property_graph_tests | t2         | 
 regression             | create_property_graph_tests | g2                  | t3                  | VERTEX             | regression    | create_property_graph_tests | t3         | 
 regression             | create_property_graph_tests | g3                  | t1                  | VERTEX             | regression    | create_property_graph_tests | t1         | 
 regression             | create_property_graph_tests | g3                  | t3                  | VERTEX             | regression    | create_property_graph_tests | t3         | 
 regression             | create_property_graph_tests | g4                  | e1                  | EDGE               | regression    | create_property_graph_tests | e1         | 
 regression             | create_property_graph_tests | g4                  | e2                  | EDGE               | regression    | create_property_graph_tests | e2         | 
 regression             | create_property_graph_tests | g4                  | t1                  | VERTEX             | regression    | create_property_graph_tests | t1         | 
 regression             | create_property_graph_tests | g4                  | t2                  | VERTEX             | regression    | create_property_graph_tests | t2         | 
 regression             | create_property_graph_tests | g4                  | t3                  | VERTEX             | regression    | create_property_graph_tests | t3         | 
 regression             | create_property_graph_tests | g5                  | t11                 | VERTEX             | regression    | create_property_graph_tests | t11        | 
 regression             | create_property_graph_tests | g5                  | t12                 | VERTEX             | regression    | create_property_graph_tests | t12        | 
 regression             | create_property_graph_tests | g5                  | t13                 | EDGE               | regression    | create_property_graph_tests | t13        | 
(15 rows)

SELECT * FROM information_schema.pg_element_table_key_columns ORDER BY property_graph_name, element_table_alias, ordinal_position;
 property_graph_catalog |    property_graph_schema    | property_graph_name | element_table_alias | column_name | ordinal_position 
------------------------+-----------------------------+---------------------+---------------------+-------------+------------------
 regression             | create_property_graph_tests | g2                  | e1                  | a           |                1
 regression             | create_property_graph_tests | g2                  | e1                  | i           |                2
 regression             | create_property_graph_tests | g2                  | e2                  | a           |                1
 regression             | create_property_graph_tests | g2                  | e2                  | x           |                2
 regression             | create_property_graph_tests | g2                  | t1                  | a           |                1
 regression             | create_property_graph_tests | g2                  | t2                  | i           |                1
 regression             | create_property_graph_tests | g2                  | t3                  | x           |                1
 regression             | create_property_graph_tests | g3                  | t1                  | a           |                1
 regression             | create_property_graph_tests | g3                  | t3                  | x           |                1
 regression             | create_property_graph_tests | g4                  | e1                  | a           |                1
 regression             | create_property_graph_tests | g4                  | e1                  | i           |                2
 regression             | create_property_graph_tests | g4                  | e2                  | a           |                1
 regression             | create_property_graph_tests | g4                  | e2                  | x           |                2
 regression             | create_property_graph_tests | g4                  | t1                  | a           |                1
 regression             | create_property_graph_tests | g4                  | t2                  | i           |                1
 regression             | create_property_graph_tests | g4                  | t3                  | x           |                1
 regression             | create_property_graph_tests | g5                  | t11                 | a           |                1
 regression             | create_property_graph_tests | g5                  | t12                 | b           |                1
 regression             | create_property_graph_tests | g5                  | t13                 | c           |                1
(19 rows)

SELECT * FROM information_schema.pg_edge_table_components ORDER BY property_graph_name, edge_table_alias, edge_end DESC, ordinal_position;
 property_graph_catalog |    property_graph_schema    | property_graph_name | edge_table_alias | vertex_table_alias |  edge_end   | edge_table_column_name | vertex_table_column_name | ordinal_position 
------------------------+-----------------------------+---------------------+------------------+--------------------+-------------+------------------------+--------------------------+------------------
 regression             | create_property_graph_tests | g2                  | e1               | t1                 | SOURCE      | a                      | a                        |                1
 regression             | create_property_graph_tests | g2                  | e1               | t2                 | DESTINATION | i                      | i                        |                1
 regression             | create_property_graph_tests | g2                  | e2               | t1                 | SOURCE      | a                      | a                        |                1
 regression             | create_property_graph_tests | g2                  | e2               | t3                 | DESTINATION | x                      | x                        |                1
 regression             | create_property_graph_tests | g2                  | e2               | t3                 | DESTINATION | t                      | y                        |                2
 regression             | create_property_graph_tests | g4                  | e1               | t1                 | SOURCE      | a                      | a                        |                1
 regression             | create_property_graph_tests | g4                  | e1               | t2                 | DESTINATION | i                      | i                        |                1
 regression             | create_property_graph_tests | g4                  | e2               | t1                 | SOURCE      | a                      | a                        |                1
 regression             | create_property_graph_tests | g4                  | e2               | t3                 | DESTINATION | x                      | x                        |                1
 regression             | create_property_graph_tests | g4                  | e2               | t3                 | DESTINATION | t                      | y                        |                2
 regression             | create_property_graph_tests | g5                  | t13              | t11                | SOURCE      | e                      | a                        |                1
 regression             | create_property_graph_tests | g5                  | t13              | t12                | DESTINATION | e                      | b                        |                1
(12 rows)

SELECT * FROM information_schema.pg_element_table_labels ORDER BY property_graph_name, element_table_alias, label_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name | element_table_alias | label_name 
------------------------+-----------------------------+---------------------+---------------------+------------
 regression             | create_property_graph_tests | g2                  | e1                  | e1
 regression             | create_property_graph_tests | g2                  | e2                  | e2
 regression             | create_property_graph_tests | g2                  | t1                  | t1
 regression             | create_property_graph_tests | g2                  | t2                  | t2
 regression             | create_property_graph_tests | g2                  | t3                  | t3l1
 regression             | create_property_graph_tests | g2                  | t3                  | t3l2
 regression             | create_property_graph_tests | g3                  | t1                  | t1
 regression             | create_property_graph_tests | g3                  | t3                  | t3l1
 regression             | create_property_graph_tests | g3                  | t3                  | t3l2
 regression             | create_property_graph_tests | g4                  | e1                  | e1
 regression             | create_property_graph_tests | g4                  | e2                  | e2
 regression             | create_property_graph_tests | g4                  | t1                  | t1
 regression             | create_property_graph_tests | g4                  | t2                  | t2
 regression             | create_property_graph_tests | g4                  | t3                  | t3l1
 regression             | create_property_graph_tests | g4                  | t3                  | t3l2
 regression             | create_property_graph_tests | g5                  | t11                 | t11
 regression             | create_property_graph_tests | g5                  | t12                 | t12
 regression             | create_property_graph_tests | g5                  | t13                 | t13
(18 rows)

SELECT * FROM information_schema.pg_element_table_properties ORDER BY property_graph_name, element_table_alias, property_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name | element_table_alias | property_name | property_expression 
------------------------+-----------------------------+---------------------+---------------------+---------------+---------------------
 regression             | create_property_graph_tests | g2                  | e1                  | a             | a
 regression             | create_property_graph_tests | g2                  | e1                  | i             | i
 regression             | create_property_graph_tests | g2                  | e1                  | t             | t
 regression             | create_property_graph_tests | g2                  | e2                  | a             | a
 regression             | create_property_graph_tests | g2                  | e2                  | t             | t
 regression             | create_property_graph_tests | g2                  | e2                  | x             | x
 regression             | create_property_graph_tests | g2                  | t1                  | a             | a
 regression             | create_property_graph_tests | g2                  | t1                  | b             | b
 regression             | create_property_graph_tests | g2                  | t2                  | i             | i
 regression             | create_property_graph_tests | g2                  | t2                  | j             | j
 regression             | create_property_graph_tests | g2                  | t2                  | k             | k
 regression             | create_property_graph_tests | g2                  | t3                  | x             | x
 regression             | create_property_graph_tests | g2                  | t3                  | y             | y
 regression             | create_property_graph_tests | g2                  | t3                  | z             | z
 regression             | create_property_graph_tests | g3                  | t1                  | a             | a
 regression             | create_property_graph_tests | g3                  | t1                  | b             | b
 regression             | create_property_graph_tests | g3                  | t3                  | x             | x
 regression             | create_property_graph_tests | g3                  | t3                  | y             | y
 regression             | create_property_graph_tests | g3                  | t3                  | z             | z
 regression             | create_property_graph_tests | g4                  | e1                  | a             | a
 regression             | create_property_graph_tests | g4                  | e1                  | i             | i
 regression             | create_property_graph_tests | g4                  | e1                  | t             | t
 regression             | create_property_graph_tests | g4                  | e2                  | a             | a
 regression             | create_property_graph_tests | g4                  | e2                  | t             | t
 regression             | create_property_graph_tests | g4                  | e2                  | x             | x
 regression             | create_property_graph_tests | g4                  | t2                  | i_j           | (i + j)
 regression             | create_property_graph_tests | g4                  | t2                  | kk            | (k * 2)
 regression             | create_property_graph_tests | g4                  | t3                  | x             | x
 regression             | create_property_graph_tests | g4                  | t3                  | yy            | y
 regression             | create_property_graph_tests | g4                  | t3                  | zz            | z
 regression             | create_property_graph_tests | g5                  | t11                 | a             | a
 regression             | create_property_graph_tests | g5                  | t12                 | b             | b
 regression             | create_property_graph_tests | g5                  | t13                 | c             | c
 regression             | create_property_graph_tests | g5                  | t13                 | d             | d
 regression             | create_property_graph_tests | g5                  | t13                 | e             | e
(35 rows)

SELECT * FROM information_schema.pg_label_properties ORDER BY property_graph_name, label_name, property_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name | label_name | property_name 
------------------------+-----------------------------+---------------------+------------+---------------
 regression             | create_property_graph_tests | g2                  | e1         | a
 regression             | create_property_graph_tests | g2                  | e1         | i
 regression             | create_property_graph_tests | g2                  | e1         | t
 regression             | create_property_graph_tests | g2                  | e2         | a
 regression             | create_property_graph_tests | g2                  | e2         | t
 regression             | create_property_graph_tests | g2                  | e2         | x
 regression             | create_property_graph_tests | g2                  | t1         | a
 regression             | create_property_graph_tests | g2                  | t1         | b
 regression             | create_property_graph_tests | g2                  | t2         | i
 regression             | create_property_graph_tests | g2                  | t2         | j
 regression             | create_property_graph_tests | g2                  | t2         | k
 regression             | create_property_graph_tests | g2                  | t3l1       | x
 regression             | create_property_graph_tests | g2                  | t3l1       | y
 regression             | create_property_graph_tests | g2                  | t3l1       | z
 regression             | create_property_graph_tests | g2                  | t3l2       | x
 regression             | create_property_graph_tests | g2                  | t3l2       | y
 regression             | create_property_graph_tests | g2                  | t3l2       | z
 regression             | create_property_graph_tests | g3                  | t1         | a
 regression             | create_property_graph_tests | g3                  | t1         | b
 regression             | create_property_graph_tests | g3                  | t3l1       | x
 regression             | create_property_graph_tests | g3                  | t3l1       | y
 regression             | create_property_graph_tests | g3                  | t3l1       | z
 regression             | create_property_graph_tests | g3                  | t3l2       | x
 regression             | create_property_graph_tests | g3                  | t3l2       | y
 regression             | create_property_graph_tests | g3                  | t3l2       | z
 regression             | create_property_graph_tests | g4                  | e1         | a
 regression             | create_property_graph_tests | g4                  | e1         | i
 regression             | create_property_graph_tests | g4                  | e1         | t
 regression             | create_property_graph_tests | g4                  | e2         | a
 regression             | create_property_graph_tests | g4                  | e2         | t
 regression             | create_property_graph_tests | g4                  | e2         | x
 regression             | create_property_graph_tests | g4                  | t2         | i_j
 regression             | create_property_graph_tests | g4                  | t2         | kk
 regression             | create_property_graph_tests | g4                  | t3l1       | x
 regression             | create_property_graph_tests | g4                  | t3l1       | yy
 regression             | create_property_graph_tests | g4                  | t3l2       | x
 regression             | create_property_graph_tests | g4                  | t3l2       | zz
 regression             | create_property_graph_tests | g5                  | t11        | a
 regression             | create_property_graph_tests | g5                  | t12        | b
 regression             | create_property_graph_tests | g5                  | t13        | c
 regression             | create_property_graph_tests | g5                  | t13        | d
 regression             | create_property_graph_tests | g5                  | t13        | e
(42 rows)

SELECT * FROM information_schema.pg_labels ORDER BY property_graph_name, label_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name | label_name 
------------------------+-----------------------------+---------------------+------------
 regression             | create_property_graph_tests | g2                  | e1
 regression             | create_property_graph_tests | g2                  | e2
 regression             | create_property_graph_tests | g2                  | t1
 regression             | create_property_graph_tests | g2                  | t2
 regression             | create_property_graph_tests | g2                  | t3l1
 regression             | create_property_graph_tests | g2                  | t3l2
 regression             | create_property_graph_tests | g3                  | t1
 regression             | create_property_graph_tests | g3                  | t3l1
 regression             | create_property_graph_tests | g3                  | t3l2
 regression             | create_property_graph_tests | g4                  | e1
 regression             | create_property_graph_tests | g4                  | e2
 regression             | create_property_graph_tests | g4                  | t1
 regression             | create_property_graph_tests | g4                  | t2
 regression             | create_property_graph_tests | g4                  | t3l1
 regression             | create_property_graph_tests | g4                  | t3l2
 regression             | create_property_graph_tests | g5                  | t11
 regression             | create_property_graph_tests | g5                  | t12
 regression             | create_property_graph_tests | g5                  | t13
(18 rows)

SELECT * FROM information_schema.pg_property_data_types ORDER BY property_graph_name, property_name;
 property_graph_catalog |    property_graph_schema    | property_graph_name | property_name | data_type | character_maximum_length | character_octet_length | character_set_catalog | character_set_schema | character_set_name | collation_catalog | collation_schema | collation_name | numeric_precision | numeric_precision_radix | numeric_scale | datetime_precision | interval_type | interval_precision | user_defined_type_catalog | user_defined_type_schema | user_defined_type_name | scope_catalog | scope_schema | scope_name | maximum_cardinality | dtd_identifier 
------------------------+-----------------------------+---------------------+---------------+-----------+--------------------------+------------------------+-----------------------+----------------------+--------------------+-------------------+------------------+----------------+-------------------+-------------------------+---------------+--------------------+---------------+--------------------+---------------------------+--------------------------+------------------------+---------------+--------------+------------+---------------------+----------------
 regression             | create_property_graph_tests | g2                  | a             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | a
 regression             | create_property_graph_tests | g2                  | b             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | b
 regression             | create_property_graph_tests | g2                  | i             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | i
 regression             | create_property_graph_tests | g2                  | j             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | j
 regression             | create_property_graph_tests | g2                  | k             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | k
 regression             | create_property_graph_tests | g2                  | t             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | t
 regression             | create_property_graph_tests | g2                  | x             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | x
 regression             | create_property_graph_tests | g2                  | y             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | y
 regression             | create_property_graph_tests | g2                  | z             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | z
 regression             | create_property_graph_tests | g3                  | a             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | a
 regression             | create_property_graph_tests | g3                  | b             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | b
 regression             | create_property_graph_tests | g3                  | x             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | x
 regression             | create_property_graph_tests | g3                  | y             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | y
 regression             | create_property_graph_tests | g3                  | z             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | z
 regression             | create_property_graph_tests | g4                  | a             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | a
 regression             | create_property_graph_tests | g4                  | i             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | i
 regression             | create_property_graph_tests | g4                  | i_j           | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | i_j
 regression             | create_property_graph_tests | g4                  | kk            | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | kk
 regression             | create_property_graph_tests | g4                  | t             | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | t
 regression             | create_property_graph_tests | g4                  | x             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | x
 regression             | create_property_graph_tests | g4                  | yy            | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | yy
 regression             | create_property_graph_tests | g4                  | zz            | text      |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | text                   |               |              |            |                     | zz
 regression             | create_property_graph_tests | g5                  | a             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | a
 regression             | create_property_graph_tests | g5                  | b             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | b
 regression             | create_property_graph_tests | g5                  | c             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | c
 regression             | create_property_graph_tests | g5                  | d             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | d
 regression             | create_property_graph_tests | g5                  | e             | integer   |                          |                        |                       |                      |                    |                   |                  |                |                   |                         |               |                    |               |                    | regression                | pg_catalog               | int4                   |               |              |            |                     | e
(27 rows)

SELECT * FROM information_schema.pg_property_graph_privileges WHERE grantee LIKE 'regress%' ORDER BY property_graph_name;
       grantor       |       grantee       | property_graph_catalog |    property_graph_schema    | property_graph_name | privilege_type | is_grantable 
---------------------+---------------------+------------------------+-----------------------------+---------------------+----------------+--------------
 regress_graph_user1 | regress_graph_user1 | regression             | create_property_graph_tests | g1                  | SELECT         | YES
 regress_graph_user1 | regress_graph_user2 | regression             | create_property_graph_tests | g1                  | SELECT         | NO
(2 rows)

\a\t
SELECT pg_get_propgraphdef('g2'::regclass);
CREATE PROPERTY GRAPH create_property_graph_tests.g2
    VERTEX TABLES (
        t1 KEY (a) PROPERTIES (a, b),
        t2 KEY (i) PROPERTIES (i, j, k),
        t3 KEY (x) LABEL t3l1 PROPERTIES (x, y, z) LABEL t3l2 PROPERTIES (x, y, z)
    )
    EDGE TABLES (
        e1 KEY (a, i) SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (i) REFERENCES t2 (i) PROPERTIES (a, i, t),
        e2 KEY (a, x) SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (x, t) REFERENCES t3 (x, y) PROPERTIES (a, t, x)
    )
SELECT pg_get_propgraphdef('g3'::regclass);
CREATE PROPERTY GRAPH create_property_graph_tests.g3
    VERTEX TABLES (
        t1 KEY (a) PROPERTIES (a, b),
        t3 KEY (x) LABEL t3l1 PROPERTIES (x, y, z) LABEL t3l2 PROPERTIES (x, y, z)
    )
SELECT pg_get_propgraphdef('g4'::regclass);
CREATE PROPERTY GRAPH create_property_graph_tests.g4
    VERTEX TABLES (
        t1 KEY (a) NO PROPERTIES,
        t2 KEY (i) PROPERTIES ((i + j) AS i_j, (k * 2) AS kk),
        t3 KEY (x) LABEL t3l1 PROPERTIES (x, y AS yy) LABEL t3l2 PROPERTIES (x, z AS zz)
    )
    EDGE TABLES (
        e1 KEY (a, i) SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (i) REFERENCES t2 (i) PROPERTIES (a, i, t),
        e2 KEY (a, x) SOURCE KEY (a) REFERENCES t1 (a) DESTINATION KEY (x, t) REFERENCES t3 (x, y) PROPERTIES (a, t, x)
    )
SELECT pg_get_propgraphdef('pg_type'::regclass);  -- error
ERROR:  "pg_type" is not a property graph
\a\t
\dG g1
                             List of relations
           Schema            | Name |      Type      |        Owner        
-----------------------------+------+----------------+---------------------
 create_property_graph_tests | g1   | property graph | regress_graph_user1
(1 row)

-- TODO
\d g1
Property graph "create_property_graph_tests.g1"
 Column | Type 
--------+------

\d+ g1
Property graph "create_property_graph_tests.g1"
 Column | Type | Storage 
--------+------+---------
Property graph definition:
 CREATE PROPERTY GRAPH create_property_graph_tests.g1

DROP TABLE g2;  -- error: wrong object type
ERROR:  "g2" is not a table
HINT:  Use DROP PROPERTY GRAPH to remove a property graph.
DROP PROPERTY GRAPH g1;
DROP PROPERTY GRAPH g1;  -- error: does not exist
ERROR:  property graph "g1" does not exist
DROP PROPERTY GRAPH IF EXISTS g1;
NOTICE:  property graph "g1" does not exist, skipping
-- leave for pg_upgrade/pg_dump tests
--DROP SCHEMA create_property_graph_tests CASCADE;
DROP ROLE regress_graph_user1, regress_graph_user2;
